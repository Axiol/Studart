/**
*  Ajax Autocomplete for jQuery, version 1.2
*  (c) 2012 Tomas Kirda
*
*  Ajax Autocomplete for jQuery is freely distributable under the terms of an MIT-style license.
*  For details, see the web site: http://www.devbridge.com/projects/autocomplete/jquery/
*
*  Last Review: 12/18/2012
*//*jslint  browser: true, white: true, plusplus: true, vars: true *//*global window: true, document: true, clearInterval: true, setInterval: true, jQuery: true */(function(e){"use strict";function n(t,r){var i=this,s={minChars:1,maxHeight:300,deferRequestBy:0,width:0,highlight:!0,params:{},formatResult:n.formatResult,delimiter:null,zIndex:9999,type:"GET",noCache:!1,enforce:!1};i.element=t;i.el=e(t);i.suggestions=[];i.badQueries=[];i.selectedIndex=-1;i.currentValue=i.element.value;i.intervalId=0;i.cachedResponse=[];i.onChangeInterval=null;i.onChange=null;i.ignoreValueChange=!1;i.isLocal=!1;i.suggestionsContainer=null;i.options=s;i.classes={selected:"autocomplete-selected",suggestion:"autocomplete-suggestion"};i.initialize();i.setOptions(r)}var t=function(){return{extend:function(t,n){return e.extend(t,n)},addEvent:function(e,t,n){if(e.addEventListener)e.addEventListener(t,n,!1);else{if(!e.attachEvent)throw new Error("Browser doesn't support addEventListener or attachEvent");e.attachEvent("on"+t,n)}},removeEvent:function(e,t,n){e.removeEventListener?e.removeEventListener(t,n,!1):e.detachEvent&&e.detachEvent("on"+t,n)},createNode:function(e){var t=document.createElement("div");t.innerHTML=e;return t.firstChild}}}();n.utils=t;e.Autocomplete=n;n.formatResult=function(e,t){var n=new RegExp("(\\"+["/",".","*","+","?","|","(",")","[","]","{","}","\\"].join("|\\")+")","g"),r="("+t.replace(n,"\\$1")+")";return e.value.replace(new RegExp(r,"gi"),"<strong>$1</strong>")};n.prototype={killerFn:null,initialize:function(){var t=this,r="."+t.classes.suggestion;this.element.setAttribute("autocomplete","off");this.killerFn=function(n){if(e(n.target).closest(".autocomplete").length===0){t.killSuggestions();t.disableKillerFn()}};if(!this.options.width||this.options.width==="auto")this.options.width=this.el.outerWidth();this.suggestionsContainer=n.utils.createNode('<div class="autocomplete" style="position: absolute; display: none;"></div>');var i=e(this.suggestionsContainer);i.appendTo("body").width(this.options.width);i.on("mouseover",r,function(){t.activate(e(this).data("index"))});i.on("click",r,function(){t.select(e(this).data("index"))});this.fixPosition();window.opera?this.el.on("keypress",function(e){t.onKeyPress(e)}):this.el.on("keydown",function(e){t.onKeyPress(e)});this.el.on("keyup",function(e){t.onKeyUp(e)});this.el.on("blur",function(){t.onBlur()});this.el.on("focus",function(){t.fixPosition()})},onBlur:function(){this.enableKillerFn()},setOptions:function(n){var r=this.options;t.extend(r,n);this.isLocal=e.isArray(r.lookup);this.isLocal&&typeof r.lookup[0]=="string"&&(r.lookup=e.map(r.lookup,function(e){return{value:e,data:null}}));e(this.suggestionsContainer).css({"max-height":r.maxHeight+"px",width:r.width,"z-index":r.zIndex})},clearCache:function(){this.cachedResponse=[];this.badQueries=[]},disable:function(){this.disabled=!0},enable:function(){this.disabled=!1},fixPosition:function(){var t=this.el.offset();e(this.suggestionsContainer).css({top:t.top+this.el.outerHeight()+"px",left:t.left+"px"})},enableKillerFn:function(){var t=this;e(document).on("click",t.killerFn)},disableKillerFn:function(){var t=this;e(document).off("click",t.killerFn)},killSuggestions:function(){var e=this;e.stopKillSuggestions();e.intervalId=window.setInterval(function(){e.hide();e.stopKillSuggestions()},300)},stopKillSuggestions:function(){window.clearInterval(this.intervalId)},onKeyPress:function(e){if(!this.disabled&&!this.visible&&e.keyCode===40&&this.currentValue){this.suggest();return}if(this.disabled||!this.visible)return;switch(e.keyCode){case 27:this.el.val(this.currentValue);this.hide();break;case 9:case 13:if(this.selectedIndex===-1){this.hide();return}this.select(this.selectedIndex);if(e.keyCode===9)return;break;case 38:this.moveUp();break;case 40:this.moveDown();break;default:return}e.stopImmediatePropagation();e.preventDefault()},onKeyUp:function(e){if(this.disabled)return;switch(e.keyCode){case 38:case 40:return}clearInterval(this.onChangeInterval);if(this.currentValue!==this.el.val())if(this.options.deferRequestBy>0){var t=this;this.onChangeInterval=setInterval(function(){t.onValueChange()},this.options.deferRequestBy)}else this.onValueChange()},onValueChange:function(){clearInterval(this.onChangeInterval);this.currentValue=this.element.value;var e=this.getQuery(this.currentValue);this.selectedIndex=-1;if(this.ignoreValueChange){this.ignoreValueChange=!1;return}e===""||e.length<this.options.minChars?this.hide():this.getSuggestions(e)},getQuery:function(t){var n=this.options.delimiter,r;if(!n)return e.trim(t);r=t.split(n);return e.trim(r[r.length-1])},getSuggestionsLocal:function(t){t=t.toLowerCase();return{suggestions:e.grep(this.options.lookup,function(e){return e.value.toLowerCase().indexOf(t)!==-1})}},getSuggestions:function(t){var n,r=this,i=r.options;n=r.isLocal?r.getSuggestionsLocal(t):r.cachedResponse[t];if(n&&e.isArray(n.suggestions)){r.suggestions=n.suggestions;r.suggest()}else if(!r.isBadQuery(t)){r.options.params.query=t;e.ajax({url:i.serviceUrl,data:i.params,type:i.type,dataType:"text"}).done(function(e){r.processResponse(e)})}},isBadQuery:function(e){var t=this.badQueries,n=t.length;while(n--)if(e.indexOf(t[n])===0)return!0;return!1},hide:function(){this.visible=!1;this.selectedIndex=-1;e(this.suggestionsContainer).hide()},suggest:function(){if(this.suggestions.length===0){this.hide();return}var t=this.suggestions.length,n=this.options.formatResult,r=this.getQuery(this.currentValue),i,s=this.classes.suggestion,o=this.classes.selected,u=e(this.suggestionsContainer),a="",f;for(f=0;f<t;f++){i=this.suggestions[f];a+='<div class="'+s+'" data-index="'+f+'">'+n(i,r)+"</div>"}u.html(a).show();this.visible=!0;this.selectedIndex=0;u.children().first().addClass(o)},processResponse:function(t){var n=e.parseJSON(t);typeof n.suggestions[0]=="string"&&(n.suggestions=e.map(n.suggestions,function(e){return{value:e,data:null}}));if(!this.options.noCache){this.cachedResponse[n.query]=n;n.suggestions.length===0&&this.badQueries.push(n.query)}if(n.query===this.getQuery(this.currentValue)){this.suggestions=n.suggestions;this.suggest()}},activate:function(t){var n,r=this.classes.selected,i=e(this.suggestionsContainer),s=i.children();i.children("."+r).removeClass(r);this.selectedIndex=t;if(this.selectedIndex!==-1&&s.length>this.selectedIndex){n=s.get(this.selectedIndex);e(n).addClass(r);return n}return null},select:function(e){var t=this.suggestions[e];if(t){this.el.val(t);this.ignoreValueChange=!0;this.hide();this.onSelect(e)}},change:function(t){var n,r=this,i=this.suggestions[t],s;if(i){s=r.suggestions[t];r.el.val(r.getValue(s.value));n=r.options.onChange;e.isFunction(n)&&n(s,r.el)}},moveUp:function(){if(this.selectedIndex===-1)return;if(this.selectedIndex===0){e(this.suggestionsContainer).children().first().removeClass(this.classes.selected);this.selectedIndex=-1;this.el.val(this.currentValue);return}this.adjustScroll(this.selectedIndex-1)},moveDown:function(){if(this.selectedIndex===this.suggestions.length-1)return;this.adjustScroll(this.selectedIndex+1)},adjustScroll:function(t){var n=this.activate(t),r,i,s,o=25;if(!n)return;r=n.offsetTop;i=e(this.suggestionsContainer).scrollTop();s=i+this.options.maxHeight-o;r<i?e(this.suggestionsContainer).scrollTop(r):r>s&&e(this.suggestionsContainer).scrollTop(r-this.options.maxHeight+o);this.el.val(this.getValue(this.suggestions[t].value))},onSelect:function(t){var n=this,r=n.options.onSelect,i=n.suggestions[t];n.el.val(n.getValue(i.value));e.isFunction(r)&&r.call(n.element,i)},getValue:function(e){var t=this,n=t.options.delimiter,r,i;if(!n)return e;r=t.currentValue;i=r.split(n);return i.length===1?e:r.substr(0,r.length-i[i.length-1].length)+e}};e.fn.autocomplete=function(t,r){return this.each(function(){var i="autocomplete",s=e(this),o;if(typeof t=="string"){o=s.data(i);typeof o[t]=="function"&&o[t](r)}else{o=new n(this,t);s.data(i,o)}})}})(jQuery);